<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin - Food Delivery</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body class="admin">
  <h1>Admin Panel</h1>

  <!-- Menu Management -->
  <section>
    <h2>Menu Items</h2>
    <form enctype="multipart/form-data" method="POST" action="/admin/menu">
      <input type="hidden" name="id" />
      <input type="text" name="name" placeholder="Item Name" required />
      <input type="number" step="0.01" name="price" placeholder="Price" required />
      <input type="file" name="image" accept="image/*" />
      <button type="submit">Save Item</button>
    </form>

    <div class="menu-grid">
      <% menu.forEach(item => { %>
        <div class="admin-item">
          <% if (item.image) { %><img src="<%= item.image %>" /><% } %>
          <p><strong><%= item.name %></strong> - $<%= item.price %></p>
          <button onclick="editItem(<%= item.id %>, '<%= item.name %>', <%= item.price %>, '<%= item.image %>')">Edit</button>
          <form style="display:inline" method="POST" action="/admin/menu/delete">
            <input type="hidden" name="id" value="<%= item.id %>" />
            <button type="submit" onclick="return confirm('Delete?')">Delete</button>
          </form>
        </div>
      <% }) %>
    </div>
  </section>

  <!-- Orders -->
  <section>
    <h2>Recent Orders</h2>
    <table>
      <tr><th>ID</th><th>Time</th><th>Customer</th><th>Address</th><th>Total</th><th>Items</th></tr>
      <% orders.forEach(o => { %>
        <% const items = JSON.parse(o.items); %>
        <tr>
          <td>#<%= o.id %></td>
          <td><%= new Date(o.created_at).toLocaleString() %></td>
          <td><%= o.name %> (<%= o.phone %>)</td>
          <td><%= o.address %></td>
          <td>$<%= o.total %></td>
          <td>
            <ul>
              <% items.forEach(i => { %>
                <li><%= i.name %> Ã—<%= i.qty %></li>
              <% }) %>
            </ul>
          </td>
        </tr>
      <% }) %>
    </table>
  </section>

  <script>
    function editItem(id, name, price, image) {
      const form = document.querySelector('form');
      form.id.value = id;
      form.name.value = name;
      form.price.value = price;
      // image preview not supported in simple edit
    }
  </script>
</body>
</html>